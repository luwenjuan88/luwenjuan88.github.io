<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="微信: 13246411679">
<meta property="og:type" content="website">
<meta property="og:title" content="卢文娟">
<meta property="og:url" content="http://example.com/page/9/index.html">
<meta property="og:site_name" content="卢文娟">
<meta property="og:description" content="微信: 13246411679">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="卢文娟">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/9/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>卢文娟</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">卢文娟</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">元宇宙，区块链，币圈知识分享，关注我公众号：元宇宙探索之旅</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-每日任务"><a href="/dailytask/" rel="section"><i class="fa fa-calendar fa-fw"></i>每日任务</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="卢文娟"
      src="/images/luwenjuan.jpeg">
  <p class="site-author-name" itemprop="name">卢文娟</p>
  <div class="site-description" itemprop="description">微信: 13246411679</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%883%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%883%EF%BC%89/" class="post-title-link" itemprop="url">智能合约项目从0到1：成功部署属于自己的智能合约（三）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-02 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-02T15:21:41+08:00">2022-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-25 18:02:40" itemprop="dateModified" datetime="2022-08-25T18:02:40+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" itemprop="url" rel="index"><span itemprop="name">智能合约</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="智能合约项目从0到1：成功部署属于自己的智能合约（三）" href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%883%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::95e0a3c91b6ffea45140a55f5184a3f2" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="第一步：修改智能合约"><a href="#第一步：修改智能合约" class="headerlink" title="第一步：修改智能合约"></a>第一步：修改智能合约</h2><p>现在我们写一下更复杂的智能合约，比如允许别人给我们打个招呼，并保存别人给我们打的招呼。</p>
<p>首先，我们需要一个方法，当他们给我们打招呼的时候调用。</p>
<p>所以，我们更新了我们的contract类，让它可以保存别人的招呼。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: UNLICENSED</span></span><br><span class="line"></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">import <span class="string">&quot;hardhat/console.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract WavePortal &#123;</span><br><span class="line">    uint256 totalWaves;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;Yo yo, I am a contract and I am smart&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">wave</span>(<span class="params"></span>) <span class="title function_">public</span> &#123;</span><br><span class="line">        totalWaves += <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;%s has waved!&quot;</span>, msg.sender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getTotalWaves</span>(<span class="params"></span>) <span class="title function_">public</span> <span class="title function_">view</span> <span class="title function_">returns</span> (<span class="params">uint256</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;We have %d total waves!&quot;</span>, totalWaves);</span><br><span class="line">        <span class="keyword">return</span> totalWaves;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们增加了一个变量totalWaves来保存打招呼的数量，这个变量初始值是0，而且它会永久保存。</p>
<p>我们还可以看到一个变量msg.sender，这个是调用这个方法的人的钱包地址，这个就可以做身份鉴定，因为我们知道调用这个方法具体的人。</p>
<p>所以说，想要在一个智能合约系统行动，哪怕做任何小的动作，都必须拥有一个钱包，而且在调用之前连接钱包，真正实现智能合约记录每一个人的行为。</p>
<p>因为有这样的功能，我们甚至可以写一些特殊合约，只有特定的某些钱包地址可以访问。</p>
<h2 id="第二步：修改调用函数"><a href="#第二步：修改调用函数" class="headerlink" title="第二步：修改调用函数"></a>第二步：修改调用函数</h2><p>当我们把智能合约部署到区块链以后，我们可以在区块链访问智能合约里的public函数。</p>
<p>这里我们需要修改一下run.js，来访问智能合约的函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">main</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [owner, randomPerson] = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="title function_">getSigners</span>();</span><br><span class="line">  <span class="keyword">const</span> waveContractFactory = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="title function_">getContractFactory</span>(<span class="string">&quot;WavePortal&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> waveContract = <span class="keyword">await</span> waveContractFactory.<span class="title function_">deploy</span>();</span><br><span class="line">  <span class="keyword">await</span> waveContract.<span class="title function_">deployed</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Contract deployed to:&quot;</span>, waveContract.<span class="property">address</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Contract deployed by:&quot;</span>, owner.<span class="property">address</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> waveCount;</span><br><span class="line">  waveCount = <span class="keyword">await</span> waveContract.<span class="title function_">getTotalWaves</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> waveTxn = <span class="keyword">await</span> waveContract.<span class="title function_">wave</span>();</span><br><span class="line">  <span class="keyword">await</span> waveTxn.<span class="title function_">wait</span>();</span><br><span class="line"></span><br><span class="line">  waveCount = <span class="keyword">await</span> waveContract.<span class="title function_">getTotalWaves</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">runMain</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">main</span>();</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">runMain</span>();</span><br></pre></td></tr></table></figure>

<p>这里我们解释一下：</p>
<blockquote>
<p>const [owner, randomPerson] &#x3D; await hre.ethers.getSigners();</p>
</blockquote>
<p>想要部署合约到区块链，我们需要钱包地址，hardhat会帮我们生成一些测试地址。</p>
<p>这里我们随机生成一些合约的钱包地址，还有用户的钱包地址。</p>
<blockquote>
<p>console.log(“Contract deployed by:”, owner.address);</p>
</blockquote>
<p>这里打印了我们的合约部署的地址。</p>
<p>这里说明一下区块链和智能合约的关系，你可以想象成为云端服务器，但他们不属于某个人，他们由世界各地的挖矿计算机运行，这些人成为挖矿者。</p>
<p>他们帮我们运行代码，然后得到回报，而具体是由谁运行，那就是通过区块链的底层运行机制来选择了，你可以百度了解一下。</p>
<p>所以这些我们合约部署的地址，也就是帮我们运行代码的地址了。</p>
<blockquote>
<p>let waveCount;<br>waveCount &#x3D; await waveContract.getTotalWaves();</p>
<p>let waveTxn &#x3D; await waveContract.wave();<br>await waveTxn.wait();</p>
<p>waveCount &#x3D; await waveContract.getTotalWaves();</p>
</blockquote>
<p>这几句代码调用函数，首先我们获取所有的招呼数量，其次我打个招呼，然后我再获取一下招呼数量。</p>
<h2 id="第三步：运行试试看"><a href="#第三步：运行试试看" class="headerlink" title="第三步：运行试试看"></a>第三步：运行试试看</h2><p>再次运行代码看看效果：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hardhat <span class="built_in">run</span> scripts/<span class="built_in">run</span>.js</span><br></pre></td></tr></table></figure>

<p><img src="http://luwenjuan.luyuedan.com/mweb/16531148661918.png"></p>
<p>你可以看到，部署智能合约的地址，和打招呼的地址是一样的，也就是，我自己在给自己打招呼。</p>
<h2 id="第四步：使用其他用户测试"><a href="#第四步：使用其他用户测试" class="headerlink" title="第四步：使用其他用户测试"></a>第四步：使用其他用户测试</h2><p>我们继续修改run.js，来让其他用户给自己打招呼。</p>
<p>其他地方不用修改，我们增加了三行：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">waveTxn</span> <span class="operator">=</span> await waveContract.connect(randomPerson).wave()<span class="comment">;</span></span><br><span class="line">await waveTxn.wait()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">waveCount</span> <span class="operator">=</span> await waveContract.getTotalWaves()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>我们修改的部分，其实就是在打招呼前，连接一下用户randomPerson的钱包地址。</p>
<p>再运行一下：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hardhat <span class="built_in">run</span> scripts/<span class="built_in">run</span>.js</span><br></pre></td></tr></table></figure>

<p><img src="http://luwenjuan.luyuedan.com/mweb/16531156871153.png"></p>
<p>我们可以看到，一共有两个打了招呼，一个是自己，还有一个是随机生成的用户。</p>
<h2 id="第五步：做一些更有意思的改动"><a href="#第五步：做一些更有意思的改动" class="headerlink" title="第五步：做一些更有意思的改动"></a>第五步：做一些更有意思的改动</h2><p>至此，其实智能合约的大概框架，都已经知道了，现在你可以考虑你想要做一个什么样的功能，并修改智能合约的内容。</p>
<p>这里我想要统计不同用户打招呼的次数，你要怎么修改代码呢，欢迎讨论。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531246057041.png"></p>
<h2 id="第六步：部署持久运行的智能合约"><a href="#第六步：部署持久运行的智能合约" class="headerlink" title="第六步：部署持久运行的智能合约"></a>第六步：部署持久运行的智能合约</h2><p>前面每次运行，都是部署后，运行完成就退出了，这里我们部署一个稳定运行的智能合约，我们随时可以和它交互。</p>
<p>因为智能合约是运行在区块链上的，那么现在，我们在本地部署一个区块链网络，我们新开一个终端，运行（这个终端运行后不能关，所以我们重新开一个）：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hardhat <span class="keyword">node</span><span class="title"></span></span><br></pre></td></tr></table></figure>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531253214365.png"></p>
<p>我们已经在本地部署了区块链，但是目前区块链是空的，还没有任何节点，所以现在我们生成一个新的节点，并让我们的智能合约在上面运行。</p>
<p>在scripts文件夹，我们创建一个文件deploy.js，这是代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">main</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [deployer] = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="title function_">getSigners</span>();</span><br><span class="line">  <span class="keyword">const</span> accountBalance = <span class="keyword">await</span> deployer.<span class="title function_">getBalance</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Deploying contracts with account: &quot;</span>, deployer.<span class="property">address</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Account balance: &quot;</span>, accountBalance.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> waveContractFactory = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="title function_">getContractFactory</span>(<span class="string">&quot;WavePortal&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> waveContract = <span class="keyword">await</span> waveContractFactory.<span class="title function_">deploy</span>();</span><br><span class="line">  <span class="keyword">await</span> waveContract.<span class="title function_">deployed</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WavePortal address: &quot;</span>, waveContract.<span class="property">address</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">runMain</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">main</span>();</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">runMain</span>();</span><br></pre></td></tr></table></figure>

<p>好的，回到原来的终端，我们运行命令：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hardhat <span class="built_in">run</span> scripts/deploy.js <span class="comment">--network localhost</span></span><br></pre></td></tr></table></figure>
<p>可以看到这样的结果：<br><img src="http://luwenjuan.luyuedan.com/mweb/16531256609593.png"></p>
<p>我们部署了智能合约，也在区块链有了地址，在我们本地区块链网络上，我们也能看到相应的信息：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531258246573.png"></p>
<p>可以看到Block #1，是指这是区块链的第一个节点。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%884%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%884%EF%BC%89/" class="post-title-link" itemprop="url">智能合约项目从0到1：部署智能合约到测试链（四）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-02 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-02T15:21:41+08:00">2022-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-25 18:11:39" itemprop="dateModified" datetime="2022-08-25T18:11:39+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" itemprop="url" rel="index"><span itemprop="name">智能合约</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="智能合约项目从0到1：部署智能合约到测试链（四）" href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%884%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::4692e0bc7bc94a937669caf2666b019e" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="注册Metamask钱包"><a href="#注册Metamask钱包" class="headerlink" title="注册Metamask钱包"></a>注册Metamask钱包</h2><p>为什么我们需要注册钱包呢？</p>
<p>在前面我们说过，我们想要访问区块链上的智能合约，是必须要先连接钱包，获取钱包地址和私钥。</p>
<p>之前在本地测试时，是使用工具生成的钱包地址，但是在真实的网络环境，我们就需要注册真实的钱包地址了。</p>
<p>注册钱包的地址：<a target="_blank" rel="noopener" href="https://metamask.io/">https://metamask.io/</a></p>
<h2 id="部署智能合约到真实的测试网络"><a href="#部署智能合约到真实的测试网络" class="headerlink" title="部署智能合约到真实的测试网络"></a>部署智能合约到真实的测试网络</h2><p>之前我们是把智能合约部署到本地了，现在我们尝试开始部署到真实的网络上，我们使用Alchemy工具。</p>
<p>我们先注册一个账号：<a target="_blank" rel="noopener" href="https://www.alchemy.com/">https://www.alchemy.com/</a></p>
<p>区块链不属于某个人，而是一系列的分布于全世界的有一份区块链拷贝的电脑，这些电脑被区块链矿工运行，如果我们想要把我们的智能合约部署到区块链上，我们需要告诉所有矿工，请你把我的智能合约加入区块链，并告诉其他所有人。</p>
<p>Alchemy的作用就是帮助我们广播我们的智能合约，让矿工尽快把我们的智能合约加入区块链。</p>
<p>当我们注册好了Alchemy之后，我们需要获取测试网络的API key，点击get started，这里我们随意填，最后一个，我们选择一个测试链Rinkeby，创建app。</p>
<p>为什么要选择测试链呢？因为如果选真实链，那个花的就是真实的钱呀，我们只有在测试完成没问题才上真实链。这个测试链是以太链的一个拷贝，是真实的矿工在运行，但是用的是虚假的钱，除了钱是假的，其他都是真的。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614220347875.png"></p>
<p>然后我们就可以看到我们的测试app了。<br><img src="http://luwenjuan.luyuedan.com/mweb/16531344976350.png"></p>
<p>点进去可以看到，这个view key，这个http字段是将要在小狐狸钱包还有hardhat里面设置的。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614220556411.png"></p>
<p>好了，接下来我们要做的就是：</p>
<blockquote>
<p>广播我们的智能合约上链请求</p>
<p>等待请求被真实矿工执行</p>
<p>等待智能合约上链</p>
<p>等待链上所有节点都更新了他们的拷贝</p>
</blockquote>
<h2 id="获取测试币"><a href="#获取测试币" class="headerlink" title="获取测试币"></a>获取测试币</h2><p>因为真实的区块链需要的是真钱，测试的区块链除了钱是假的，其他都是真的，所以我们需要去向这个测试网络申请一些测试币，当然这个测试币只能在测试网络使用。</p>
<p>在申请测试币之前，我们的小狐狸钱包也要添加这个测试链，url是刚刚查看的http字段，ID是4，不用管红色字体，保存即可。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531363333590.png"></p>
<p>当我们的小狐狸钱包连接到了测试链，我们进入这个网址申请测试币：<a target="_blank" rel="noopener" href="https://app.mycrypto.com/faucet">https://app.mycrypto.com/faucet</a></p>
<p>第一次点进去的时候，需要连接小狐狸钱包，连接成功后，我们退出网站再次进入，就会有这样的界面：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531367396079.png"></p>
<p>选择我们的钱包账号，request即可。</p>
<h2 id="部署到Rinkeby测试链"><a href="#部署到Rinkeby测试链" class="headerlink" title="部署到Rinkeby测试链"></a>部署到Rinkeby测试链</h2><p>要配置测试链，我们要修改代码的hardhat.config.js文件，由于这个文件涉及到账号的key，所以我们用一个工具来保护这个key：</p>
<p>在终端运行：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="comment">--save dotenv</span></span><br></pre></td></tr></table></figure>

<p>hardhat.config.js文件内容：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">require(<span class="string">&quot;@nomiclabs/hardhat-waffle&quot;</span>)<span class="punctuation">;</span></span><br><span class="line"><span class="comment">// Import and configure dotenv</span></span><br><span class="line">require(<span class="string">&quot;dotenv&quot;</span>).config()<span class="punctuation">;</span></span><br><span class="line"></span><br><span class="line">module.<span class="attr">exports</span> <span class="operator">=</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">  solidity:</span> <span class="string">&quot;0.8.0&quot;</span>,</span><br><span class="line"><span class="symbol">  networks:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">    rinkeby:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// This value will be replaced on runtime</span></span><br><span class="line"><span class="symbol">      url:</span> process.env.STAGING_ALCHEMY_KEY,</span><br><span class="line"><span class="symbol">      accounts:</span> [process.env.PRIVATE_KEY],</span><br><span class="line">    <span class="punctuation">&#125;</span>,</span><br><span class="line"><span class="symbol">    mainnet:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">      chainId:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">      url:</span> process.env.PROD_ALCHEMY_KEY,</span><br><span class="line"><span class="symbol">      accounts:</span> [process.env.PRIVATE_KEY],</span><br><span class="line">    <span class="punctuation">&#125;</span>,</span><br><span class="line">  <span class="punctuation">&#125;</span>,</span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>在项目的根目录，创建一个.env文件：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">STAGING_ALCHEMY_KEY</span>=REPLACE_WITH_ACTUAL_ALCHEMY_URL</span><br><span class="line"><span class="attribute">PROD_ALCHEMY_KEY</span>=BLAHBLAH</span><br><span class="line">PRIVATE_KEY=</span><br></pre></td></tr></table></figure>

<p>这里第一个URL是我们的前面看到的Alchemy里面的http字段;</p>
<p>private key是小狐狸钱包里面的，在小狐狸钱包里，切换网络到Rinkeby网络，点击右上角三个点-&gt;账户详情-&gt;导出私钥</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614220767024.png"></p>
<p>.env文件不要上传到公网，因为这个key和你主网络的key是一样的，所以把.env文件加入.gitignore文件中。</p>
<p>在终端运行以下命令：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hardhat <span class="built_in">run</span> scripts/deploy.js <span class="comment">--network rinkeby</span></span><br></pre></td></tr></table></figure>

<p>可以看到，这个命令和之前命令不同地方在于，之前使用localhost，而这里使用了rinkeby。</p>
<p>ok，可以看到，运行成功。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531421564979.png"></p>
<p>请记住最后一个address，这个在后面需要使用：0xc850155CB95A1a73e9a1FA4ca0cF96089112b744。</p>
<p>使用这个address，我们也可以在区块链浏览器上搜索到我们的智能合约：<a target="_blank" rel="noopener" href="https://rinkeby.etherscan.io/">https://rinkeby.etherscan.io/</a></p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531422466407.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%885%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%885%EF%BC%89/" class="post-title-link" itemprop="url">智能合约项目从0到1：客户端网站连接小狐狸钱包（五）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-02 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-02T15:21:41+08:00">2022-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-25 18:11:57" itemprop="dateModified" datetime="2022-08-25T18:11:57+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" itemprop="url" rel="index"><span itemprop="name">智能合约</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="智能合约项目从0到1：客户端网站连接小狐狸钱包（五）" href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%885%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::7d78fe0add17d96446aa96b54e77365e" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我们的智能合约已经成功部署到了区块链上，那么接下来就是我们如何通过客户端来访问区块链服务了。</p>
<h2 id="使用Replit开发客户端"><a href="#使用Replit开发客户端" class="headerlink" title="使用Replit开发客户端"></a>使用Replit开发客户端</h2><p>我们使用Replit来开发客户端，Replit是一个基于浏览器的IDE，我们可以方便的使用它来构建我们的web app，并部署到浏览器。</p>
<p>我们需要先注册Replit账号，链接：<a target="_blank" rel="noopener" href="https://replit.com/login?goto=/">https://replit.com/login?goto=%2F</a>~</p>
<p>然后我们可以使用一个现成的框架：<a target="_blank" rel="noopener" href="https://replit.com/@adilanchian/waveportal-starter-project?v=1">https://replit.com/@adilanchian/waveportal-starter-project?v=1</a></p>
<p>点击左上角的Fork repl，可以把这个项目放入自己的空间，并进行进一步的开发。</p>
<p>就是这样子了，加载完毕之后，点击右上角的绿色按钮run，就可以运行了，这时我们对代码的改动，会实时反应到网页上，这里我已经点击了run，所以按钮变成了stop。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531277423829.png"></p>
<p>接下来，为了让我们的网站连接到区块链，我们需要连接钱包，因为只有当网站连接钱包之后，才能够允许调用智能合约。</p>
<h2 id="检查钱包是否登陆"><a href="#检查钱包是否登陆" class="headerlink" title="检查钱包是否登陆"></a>检查钱包是否登陆</h2><p>如果我们登陆了小狐狸钱包，它将会自动在窗口产生一个对象ethereum，通过检查这个对象，我们可以检查钱包状态。</p>
<p>在前端代码中，找到src的App.jsx文件，添加这些代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">checkIfWalletIsConnected</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * First make sure we have access to window.ethereum</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">const</span> &#123; ethereum &#125; = <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!ethereum) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Make sure you have metamask!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;We have the ethereum object&quot;</span>, ethereum);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * This runs our function when the page loads.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">checkIfWalletIsConnected</span>();</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mainContainer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;dataContainer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        👋 Hey there!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bio&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          I am farza and I worked on self-driving cars so that&#x27;s pretty cool right? Connect your Ethereum wallet and wave at me!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;waveButton&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;null&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Wave at Me</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<p>checkIfWalletIsConnected是一个检查勤包的函数，当网页加载的时候，这个函数会被运行。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16532880093047.png"></p>
<p>我的钱包一直是登陆状态，所以显示我有这个ethereum对象。</p>
<h2 id="检查钱包是否被我们的网站授权"><a href="#检查钱包是否被我们的网站授权" class="headerlink" title="检查钱包是否被我们的网站授权"></a>检查钱包是否被我们的网站授权</h2><p>接下来，我们就要检查能否连接到钱包，因为网站要连接钱包，是要经过我们的授权的。</p>
<p>我们修改App.jsx文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * Just a state variable we use to store our user&#x27;s public wallet.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">const</span> [currentAccount, setCurrentAccount] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">checkIfWalletIsConnected</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; ethereum &#125; = <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!ethereum) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Make sure you have metamask!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;We have the ethereum object&quot;</span>, ethereum);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      * Check if we&#x27;re authorized to access the user&#x27;s wallet</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">const</span> accounts = <span class="keyword">await</span> ethereum.<span class="title function_">request</span>(&#123; <span class="attr">method</span>: <span class="string">&quot;eth_accounts&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (accounts.<span class="property">length</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> account = accounts[<span class="number">0</span>];</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Found an authorized account:&quot;</span>, account);</span><br><span class="line">        <span class="title function_">setCurrentAccount</span>(account)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;No authorized account found&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">checkIfWalletIsConnected</span>();</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mainContainer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;dataContainer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          👋 Hey there!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bio&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          I am farza and I worked on self-driving cars so that&#x27;s pretty cool right? Connect your Ethereum wallet and wave at me!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;waveButton&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;null&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Wave at Me</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>const accounts &#x3D; await ethereum.request({ method: “eth_accounts” });</p>
</blockquote>
<p>这一句获取已有的钱包账号列表。</p>
<p>如果是第一次连接，那么我们的网站肯定是没有被钱包授权的，所以结果显示：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16532885038365.png"></p>
<h2 id="授权网站连接钱包"><a href="#授权网站连接钱包" class="headerlink" title="授权网站连接钱包"></a>授权网站连接钱包</h2><p>我们在网站放一个连接钱包的按钮，当我们按下按钮时，网站请求连接钱包。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [currentAccount, setCurrentAccount] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">checkIfWalletIsConnected</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; ethereum &#125; = <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!ethereum) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Make sure you have metamask!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;We have the ethereum object&quot;</span>, ethereum);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> accounts = <span class="keyword">await</span> ethereum.<span class="title function_">request</span>(&#123; <span class="attr">method</span>: <span class="string">&quot;eth_accounts&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (accounts.<span class="property">length</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> account = accounts[<span class="number">0</span>];</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Found an authorized account:&quot;</span>, account);</span><br><span class="line">        <span class="title function_">setCurrentAccount</span>(account);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;No authorized account found&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Implement your connectWallet method here</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">connectWallet</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; ethereum &#125; = <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!ethereum) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;Get MetaMask!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> accounts = <span class="keyword">await</span> ethereum.<span class="title function_">request</span>(&#123; <span class="attr">method</span>: <span class="string">&quot;eth_requestAccounts&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Connected&quot;</span>, accounts[<span class="number">0</span>]);</span><br><span class="line">      <span class="title function_">setCurrentAccount</span>(accounts[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">checkIfWalletIsConnected</span>();</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mainContainer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;dataContainer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        👋 Hey there!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bio&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          I am farza and I worked on self-driving cars so that&#x27;s pretty cool right? Connect your Ethereum wallet and wave at me!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;waveButton&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;null&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Wave at Me</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        &#123;/*</span></span><br><span class="line"><span class="language-xml">        * If there is no currentAccount render this button</span></span><br><span class="line"><span class="language-xml">        */&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;!currentAccount &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;waveButton&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;connectWallet&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Connect Wallet</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        )&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>const accounts &#x3D; await ethereum.request({ method: “eth_requestAccounts” });</p>
</blockquote>
<p>我们定义了connectWallet函数连接钱包，这一句代码请求连接我们的钱包账号。</p>
<p>当我们的网站没有被钱包授权时，会显示这个按钮Connect Wallet，否则这个按钮不会显示，当我们点击网页的按钮时，就会调用连接钱包的函数。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16532890444849.png"></p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16532896608291.png"></p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614222661429.png"></p>
<p>好了，连接到小狐狸钱包，connect wallnet的按钮消失了。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16532897432800.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%886%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%886%EF%BC%89/" class="post-title-link" itemprop="url">智能合约项目从0到1：从网站调用区块链合约（六）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-02 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-02T15:21:41+08:00">2022-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-25 18:16:39" itemprop="dateModified" datetime="2022-08-25T18:16:39+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" itemprop="url" rel="index"><span itemprop="name">智能合约</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="智能合约项目从0到1：从网站调用区块链合约（六）" href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%886%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::c94ee427869015038d22f39c8d4c948d" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="从网站调用智能合约"><a href="#从网站调用智能合约" class="headerlink" title="从网站调用智能合约"></a>从网站调用智能合约</h2><p>在App.jsx中增加一个函数，来调用智能合约。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">wave</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; ethereum &#125; = <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (ethereum) &#123;</span><br><span class="line">        <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="property">providers</span>.<span class="title class_">Web3Provider</span>(ethereum);</span><br><span class="line">        <span class="keyword">const</span> signer = provider.<span class="title function_">getSigner</span>();</span><br><span class="line">        <span class="keyword">const</span> wavePortalContract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(contractAddress, contractABI, signer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> count = <span class="keyword">await</span> wavePortalContract.<span class="title function_">getTotalWaves</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Retrieved total wave count...&quot;</span>, count.<span class="title function_">toNumber</span>());</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Ethereum object doesn&#x27;t exist!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里解释一下：</p>
<blockquote>
<p>const provider &#x3D; new ethers.providers.Web3Provider(ethereum);</p>
<p>const signer &#x3D; provider.getSigner();</p>
</blockquote>
<p>ethers是帮我们和智能合约对话的库，在代码前面，记得加上import { ethers } from “ethers”;导入这个库。</p>
<p>这里生成了一个provider，provider是用来和部署在以太坊节点上的智能合约通信的模块。</p>
<p>修改按钮的值，当我们点击wave at me 按钮的时候，调用这个函数：<br><img src="http://luwenjuan.luyuedan.com/mweb/16533053593077.png"></p>
<h2 id="设置地址和ABI"><a href="#设置地址和ABI" class="headerlink" title="设置地址和ABI"></a>设置地址和ABI</h2><p>这里还需要两个东西：</p>
<p>contractAddress<br>contractABI</p>
<p>contractAddress是什么？在之前部署Rinkby测试网络的时候，有一个contract地址，我们记下了WavePortal Adress，就是这个：0xc850155CB95A1a73e9a1FA4ca0cF96089112b744</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16531421564979.png"></p>
<p>我们要和节点通信，自然要获取到节点的地址，所以我们设置一个变量加入App.jsx文件中。</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const contractAddress <span class="operator">=</span> <span class="string">&quot;0xc850155CB95A1a73e9a1FA4ca0cF96089112b744&quot;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>ABI（合约应用二进制接口）是在以太坊生态系统中与合约交互的标准方式，这个规范规定了网站应该怎样和智能合约通信。</p>
<p>我们之前在编译智能合约的时候，有一个文件夹是artifacts，这个文件夹是编译时生成的一系列文件，contractABI就是artifacts的一个json文件WavePortal.json。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16533062683524.png"></p>
<p>在src文件夹下新建一个utils文件夹，我们把这个json文件复制到这个文件夹里。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16533065720349.png"></p>
<p>接下来我们就在App.jsx里面引用这个文件：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ethers &#125; <span class="keyword">from</span> <span class="string">&quot;ethers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> abi <span class="keyword">from</span> <span class="string">&quot;./utils/WavePortal.json&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [currentAccount, setCurrentAccount] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> contractAddress = <span class="string">&quot;0xd5f08a0ae197482FA808cE84E00E97d940dBD26E&quot;</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Create a variable here that references the abi content!</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> contractABI = abi.abi;</span><br></pre></td></tr></table></figure>
<p>我们再看wave函数后面几行：</p>
<blockquote>
<p>const wavePortalContract &#x3D; new ethers.Contract(contractAddress, contractABI, signer);</p>
<p>let count &#x3D; await wavePortalContract.getTotalWaves();</p>
</blockquote>
<p>在获取signer之后，通过abi连接以太坊节点，来调用智能合约函数。</p>
<h2 id="向智能合约写数据"><a href="#向智能合约写数据" class="headerlink" title="向智能合约写数据"></a>向智能合约写数据</h2><p>写数据和读数据的区别在于，写数据的时候，我们要通知矿工我们要修改了数据，这样矿工才能操作挖矿，这个数据就能被修改，因为别人干活了，所以我们要付挖矿的燃油费；</p>
<p>而读数据我们不需要这一步，所以读数据都是免费的。</p>
<p>我们修改wave函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">wave</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; ethereum &#125; = <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (ethereum) &#123;</span><br><span class="line">        <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="property">providers</span>.<span class="title class_">Web3Provider</span>(ethereum);</span><br><span class="line">        <span class="keyword">const</span> signer = provider.<span class="title function_">getSigner</span>();</span><br><span class="line">        <span class="keyword">const</span> wavePortalContract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(contractAddress, contractABI, signer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> count = <span class="keyword">await</span> wavePortalContract.<span class="title function_">getTotalWaves</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Retrieved total wave count...&quot;</span>, count.<span class="title function_">toNumber</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * Execute the actual wave from your smart contract</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">const</span> waveTxn = <span class="keyword">await</span> wavePortalContract.<span class="title function_">wave</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mining...&quot;</span>, waveTxn.<span class="property">hash</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> waveTxn.<span class="title function_">wait</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mined -- &quot;</span>, waveTxn.<span class="property">hash</span>);</span><br><span class="line"></span><br><span class="line">        count = <span class="keyword">await</span> wavePortalContract.<span class="title function_">getTotalWaves</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Retrieved total wave count...&quot;</span>, count.<span class="title function_">toNumber</span>());</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Ethereum object doesn&#x27;t exist!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这里，我们调用wave函数，其实就是写数据的函数，所以我们有等待挖矿的操作，当我们运行的时候，小狐狸钱包也会提醒我们支付gas费，一切都是按照正常的来操作。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/IMG_9607.GIF" alt="IMG_9607"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%887%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%887%EF%BC%89/" class="post-title-link" itemprop="url">智能合约项目从0到1：实现向智能合约发送消息（七）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-02 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-02T15:21:41+08:00">2022-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-25 18:20:36" itemprop="dateModified" datetime="2022-08-25T18:20:36+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" itemprop="url" rel="index"><span itemprop="name">智能合约</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="智能合约项目从0到1：实现向智能合约发送消息（七）" href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%887%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::995647e2e98cb2e3507218712d7e28ee" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="修改合约功能"><a href="#修改合约功能" class="headerlink" title="修改合约功能"></a>修改合约功能</h2><p>这里，我们最终是希望做到让用户可以给我们发送消息，而且我们可以显示所有过去用户发送给我们的消息。</p>
<p>所以我们要做三件事：</p>
<blockquote>
<p>让用户打招呼的同时，提交他们的消息</p>
<p>把用户发送过来的消息保存在区块链</p>
<p>在网站上显示所有数据</p>
</blockquote>
<p>这是修改后的智能合约代码：</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: UNLICENSED</span></span><br><span class="line"></span><br><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">import <span class="string">&quot;hardhat/console.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract WavePortal &#123;</span><br><span class="line">    uint256 totalWaves;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * A little magic, Google what events are in Solidity!</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    event NewWave(address indexed from, uint256 <span class="built_in">timestamp</span>, string message);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * I created a struct here named Wave.</span></span><br><span class="line"><span class="comment">     * A struct is basically a custom datatype where we can customize what we want to hold inside it.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    struct Wave &#123;</span><br><span class="line">        address waver; <span class="comment">// The address of the user who waved.</span></span><br><span class="line">        string message; <span class="comment">// The message the user sent.</span></span><br><span class="line">        uint256 <span class="built_in">timestamp</span>; <span class="comment">// The timestamp when the user waved.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * I declare a variable waves that lets me store an array of structs.</span></span><br><span class="line"><span class="comment">     * This is what lets me hold all the waves anyone ever sends to me!</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Wave[] waves;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;I AM SMART CONTRACT. POG.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * You&#x27;ll notice I changed the wave function a little here as well and</span></span><br><span class="line"><span class="comment">     * now it requires a string called _message. This is the message our user</span></span><br><span class="line"><span class="comment">     * sends us from the frontend!</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">wave</span>(<span class="params">string memory _message</span>) <span class="title function_">public</span> &#123;</span><br><span class="line">        totalWaves += <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;%s waved w/ message %s&quot;</span>, msg.sender, _message);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * This is where I actually store the wave data in the array.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        waves.<span class="built_in">push</span>(Wave(msg.sender, _message, block.<span class="built_in">timestamp</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * I added some fanciness here, Google it and try to figure out what it is!</span></span><br><span class="line"><span class="comment">         * Let me know what you learn in #general-chill-chat</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        emit NewWave(msg.sender, block.<span class="built_in">timestamp</span>, _message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * I added a function getAllWaves which will return the struct array, waves, to us.</span></span><br><span class="line"><span class="comment">     * This will make it easy to retrieve the waves from our website!</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getAllWaves</span>(<span class="params"></span>) <span class="title function_">public</span> <span class="title function_">view</span> <span class="title function_">returns</span> (<span class="params">Wave[] memory</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> waves;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getTotalWaves</span>(<span class="params"></span>) <span class="title function_">public</span> <span class="title function_">view</span> <span class="title function_">returns</span> (<span class="params">uint256</span>) &#123;</span><br><span class="line">        <span class="comment">// Optional: Add this line if you want to see the contract print the value!</span></span><br><span class="line">        <span class="comment">// We&#x27;ll also print it over in run.js as well.</span></span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;We have %d total waves!&quot;</span>, totalWaves);</span><br><span class="line">        <span class="keyword">return</span> totalWaves;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>struct Wave {<br>        address waver;<br>        string message;<br>        uint256 timestamp;<br>  }</p>
</blockquote>
<p>这里我们定义了一个结构体来保存用户发过来的消息，waver是打招呼的地址，message是这个地址发过来的消息，timestamp是发消息的时间。</p>
<blockquote>
<p>event NewWave(address indexed from, uint256 timestamp, string message);</p>
</blockquote>
<p>另外我们还定义了一个事件，当我们打招呼处理完之后，就调用这个事件。</p>
<p>在我们每次修改完智能合约之后，我们都要用run.js测试一下功能，所以我们修改一下run.js的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">main</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> waveContractFactory = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="title function_">getContractFactory</span>(<span class="string">&quot;WavePortal&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> waveContract = <span class="keyword">await</span> waveContractFactory.<span class="title function_">deploy</span>();</span><br><span class="line">  <span class="keyword">await</span> waveContract.<span class="title function_">deployed</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Contract addy:&quot;</span>, waveContract.<span class="property">address</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> waveCount;</span><br><span class="line">  waveCount = <span class="keyword">await</span> waveContract.<span class="title function_">getTotalWaves</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(waveCount.<span class="title function_">toNumber</span>());</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Let&#x27;s send a few waves!</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">let</span> waveTxn = <span class="keyword">await</span> waveContract.<span class="title function_">wave</span>(<span class="string">&quot;A message!&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> waveTxn.<span class="title function_">wait</span>(); <span class="comment">// Wait for the transaction to be mined</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [_, randomPerson] = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="title function_">getSigners</span>();</span><br><span class="line">  waveTxn = <span class="keyword">await</span> waveContract.<span class="title function_">connect</span>(randomPerson).<span class="title function_">wave</span>(<span class="string">&quot;Another message!&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> waveTxn.<span class="title function_">wait</span>(); <span class="comment">// Wait for the transaction to be mined</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> allWaves = <span class="keyword">await</span> waveContract.<span class="title function_">getAllWaves</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(allWaves);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">runMain</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">main</span>();</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">runMain</span>();</span><br></pre></td></tr></table></figure>

<p>我们先在本地测试功能，我们在终端运行命令：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hardhat <span class="built_in">run</span> scripts/<span class="built_in">run</span>.js</span><br></pre></td></tr></table></figure>

<p>这是运行结果，我们可以看到打印出来的内容，一共有两个消息，timestamp是bignumber的类型。<br><img src="http://luwenjuan.luyuedan.com/mweb/16536534304836.png"></p>
<p>功能测试没有问题，那么我们的智能合约已经修改，就要重新再次部署到区块链上。</p>
<h2 id="重新部署合约"><a href="#重新部署合约" class="headerlink" title="重新部署合约"></a>重新部署合约</h2><p>在我们每次修改完智能合约后，我们需要做三件事：</p>
<blockquote>
<p>重新部署，记下新的合约地址</p>
<p>在网页端修改合约地址</p>
<p>在网页端修改abi文件</p>
</blockquote>
<p>为什么要做这三件事呢？因为智能合约是不可变的，这也意味着更改合约就需要重新部署，所有变量都是重置的，它会成为一个全新的合约，也就是说，修改了合约代码，所有的wave数据也会改变。</p>
<p>所以说，这里我们做三件事：</p>
<blockquote>
<p>重新部署：npx hardhat run scripts&#x2F;deploy.js –network rinkeby</p>
<p>修改App.js的contractAddress字段</p>
<p>把artifacts文件夹里的abi内容复制到前端</p>
</blockquote>
<p>那么我们重新做一遍：</p>
<p>运行命令：<br><img src="http://luwenjuan.luyuedan.com/mweb/16536539575898.png"></p>
<p>记下adress：0xb3E8260eDaF2D91034314e4b1C551047dc5Dfac0</p>
<p>修改adress：<br><img src="http://luwenjuan.luyuedan.com/mweb/16536540486397.png"></p>
<p>修改abi：<br><img src="http://luwenjuan.luyuedan.com/mweb/16536542904664.png"></p>
<h2 id="修改前端代码"><a href="#修改前端代码" class="headerlink" title="修改前端代码"></a>修改前端代码</h2><p>现在智能合约已经修改，现在只需要修改前端就行。</p>
<p>在app.js添加一个函数getAllWaves：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [currentAccount, setCurrentAccount] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * All state property to store all waves</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> [allWaves, setAllWaves] = <span class="title function_">useState</span>([]);</span><br><span class="line">  <span class="keyword">const</span> contractAddress = <span class="string">&quot;0xb3E8260eDaF2D91034314e4b1C551047dc5Dfac0&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * Create a method that gets all waves from your contract</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getAllWaves</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; ethereum &#125; = <span class="variable language_">window</span>;</span><br><span class="line">      <span class="keyword">if</span> (ethereum) &#123;</span><br><span class="line">        <span class="keyword">const</span> provider = <span class="keyword">new</span> ethers.<span class="property">providers</span>.<span class="title class_">Web3Provider</span>(ethereum);</span><br><span class="line">        <span class="keyword">const</span> signer = provider.<span class="title function_">getSigner</span>();</span><br><span class="line">        <span class="keyword">const</span> wavePortalContract = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(contractAddress, contractABI, signer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Call the getAllWaves method from your Smart Contract</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">const</span> waves = <span class="keyword">await</span> wavePortalContract.<span class="title function_">getAllWaves</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * We only need address, timestamp, and message in our UI so let&#x27;s</span></span><br><span class="line"><span class="comment">         * pick those out</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">let</span> wavesCleaned = [];</span><br><span class="line">        waves.<span class="title function_">forEach</span>(<span class="function"><span class="params">wave</span> =&gt;</span> &#123;</span><br><span class="line">          wavesCleaned.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">address</span>: wave.<span class="property">waver</span>,</span><br><span class="line">            <span class="attr">timestamp</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(wave.<span class="property">timestamp</span> * <span class="number">1000</span>),</span><br><span class="line">            <span class="attr">message</span>: wave.<span class="property">message</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Store our data in React State</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="title function_">setAllWaves</span>(wavesCleaned);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Ethereum object doesn&#x27;t exist!&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>当我们确定用户已经链接上了钱包，我们就调用这个函数getAllWaves，因为我们不管调用任何函数都需要一个地址。</p>
<p>所以我们在这里调用：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16536555520309.png"></p>
<p>接下来我们要更新html的代码：</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">return (</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;mainContainer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;dataContainer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          👋 Hey there!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;bio&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          I am farza and I worked on self-driving cars so that&#x27;s pretty cool right? Connect your Ethereum wallet and wave at me!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;waveButton&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;wave&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Wave at Me</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        &#123;!currentAccount &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;waveButton&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;connectWallet&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Connect Wallet</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        )&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        &#123;allWaves.map((wave, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          return (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">style</span>=</span></span><span class="template-variable">&#123;&#123; <span class="name">backgroundColor:</span> <span class="string">&quot;OldLace&quot;</span>, marginTop: <span class="string">&quot;16px&quot;</span>, padding: <span class="string">&quot;8px&quot;</span> &#125;&#125;</span><span class="language-xml"><span class="tag">&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span>&gt;</span>Address: &#123;wave.address&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span>&gt;</span>Time: &#123;wave.timestamp.toString()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span>&gt;</span>Message: &#123;wave.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</span></span><br><span class="line"><span class="language-xml">        &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  );</span></span><br></pre></td></tr></table></figure>

<p>这里，我们遍历allwaves，然后对于每一个wave，创建一个新的div来在屏幕展示。</p>
<p>最后，我们要注意，这次的wave函数需要带一个参数，因为我们每次打招呼，还需要发一个消息。</p>
<p>所以我们在界面上加一个文本框，输入我们想发的消息，点击wave的按钮，调用wave函数发送消息。</p>
<p>要怎么实现呢？<br><img src="http://luwenjuan.luyuedan.com/mweb/16536601133834.png"></p>
<p>我们在wave按钮上方增加一个文本输入框。</p>
<p>然后在wave函数中，获取这个文本框的内容，并传给wave函数：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16536601685418.png"></p>
<p>我们看一下效果：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16536601960650.png"></p>
<p>这里展示了过去发送的消息。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%888%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%888%EF%BC%89/" class="post-title-link" itemprop="url">智能合约项目从0到1：给用户发以太币（八）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-02 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-02T15:21:41+08:00">2022-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-25 18:32:42" itemprop="dateModified" datetime="2022-08-25T18:32:42+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" itemprop="url" rel="index"><span itemprop="name">智能合约</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="智能合约项目从0到1：给用户发以太币（八）" href="/2022/07/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%888%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::f6591b35eb659c92e9dd3311655d3f9e" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="给用户发以太币"><a href="#给用户发以太币" class="headerlink" title="给用户发以太币"></a>给用户发以太币</h2><p>向用户发送以太币是智能合约的一个重要功能，现在，我们可以实现一个功能，给向我们打招呼的用户钱包投以太币。</p>
<p>我们先给每个用户直接发送0.0001ETH，这里修改WavePortal.sol里面的wave函数：</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">wave</span>(<span class="params">string memory _message</span>) <span class="title function_">public</span> &#123;</span><br><span class="line">    totalWaves += <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;%s has waved!&quot;</span>, msg.sender);</span><br><span class="line"></span><br><span class="line">    waves.<span class="built_in">push</span>(Wave(msg.sender, _message, block.<span class="built_in">timestamp</span>));</span><br><span class="line"></span><br><span class="line">    emit NewWave(msg.sender, block.<span class="built_in">timestamp</span>, _message);</span><br><span class="line"></span><br><span class="line">    uint256 prizeAmount = <span class="number">0.0001</span> ether;</span><br><span class="line">    require(</span><br><span class="line">        prizeAmount &lt;= address(this).balance,</span><br><span class="line">        <span class="string">&quot;Trying to withdraw more money than the contract has.&quot;</span></span><br><span class="line">    );</span><br><span class="line">    (bool success, ) = (msg.sender).call&#123;<span class="attr">value</span>: prizeAmount&#125;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    require(success, <span class="string">&quot;Failed to withdraw money from contract.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>uint256 prizeAmount &#x3D; 0.0001 ether;</p>
</blockquote>
<p>这里prizeAmount我们声明了一个价格，Solidity运行我们直接使用ether表示金融单位。</p>
<blockquote>
<p>require(<br>            prizeAmount &lt;&#x3D; address(this).balance,<br>            “Trying to withdraw more money than the contract has.”<br>        );</p>
</blockquote>
<p>这个require会检查条件是否为真，如果不为真的话，就会直接退出函数。</p>
<p>这里价差是否我们设置的数量是小于等于钱包的钱，因为之后小于等于钱包的钱，我们才能给用户发这么多钱。</p>
<blockquote>
<p>(msg.sender).call{value: prizeAmount}(“”)</p>
</blockquote>
<p>这句代码就是发送钱。</p>
<p>除此以外，我们还需要修改constructor函数，增加关键字payable：</p>
<blockquote>
<p>constructor() payable {<br>    console.log(“We have been constructed!”);<br>  }</p>
</blockquote>
<p>payable关键词用来修饰结构函数，代表我们的智能合约是可以有支付功能的，否则默认是不具备支付功能的智能合约。</p>
<p>不过现在这个函数应该无法执行，因为我们的智能合约钱包没有钱。</p>
<h2 id="给我们的智能合约充钱"><a href="#给我们的智能合约充钱" class="headerlink" title="给我们的智能合约充钱"></a>给我们的智能合约充钱</h2><p>修改run.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">main</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> waveContractFactory = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="title function_">getContractFactory</span>(<span class="string">&quot;WavePortal&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> waveContract = <span class="keyword">await</span> waveContractFactory.<span class="title function_">deploy</span>(&#123;</span><br><span class="line">    <span class="attr">value</span>: hre.<span class="property">ethers</span>.<span class="property">utils</span>.<span class="title function_">parseEther</span>(<span class="string">&quot;0.1&quot;</span>),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> waveContract.<span class="title function_">deployed</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Contract addy:&quot;</span>, waveContract.<span class="property">address</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * Get Contract balance</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">let</span> contractBalance = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="property">provider</span>.<span class="title function_">getBalance</span>(</span><br><span class="line">    waveContract.<span class="property">address</span></span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    <span class="string">&quot;Contract balance:&quot;</span>,</span><br><span class="line">    hre.<span class="property">ethers</span>.<span class="property">utils</span>.<span class="title function_">formatEther</span>(contractBalance)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * Send Wave</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">let</span> waveTxn = <span class="keyword">await</span> waveContract.<span class="title function_">wave</span>(<span class="string">&quot;A message!&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> waveTxn.<span class="title function_">wait</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * Get Contract balance to see what happened!</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  contractBalance = <span class="keyword">await</span> hre.<span class="property">ethers</span>.<span class="property">provider</span>.<span class="title function_">getBalance</span>(waveContract.<span class="property">address</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    <span class="string">&quot;Contract balance:&quot;</span>,</span><br><span class="line">    hre.<span class="property">ethers</span>.<span class="property">utils</span>.<span class="title function_">formatEther</span>(contractBalance)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> allWaves = <span class="keyword">await</span> waveContract.<span class="title function_">getAllWaves</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(allWaves);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">runMain</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">main</span>();</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">runMain</span>();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>hre.ethers.utils.parseEther(“0.1”)</p>
</blockquote>
<p>这句代码的意思就是，部署智能合约的时候，给他冲0.1ETH，这会从我的钱包里面扣除，并用来给智能合约充钱。</p>
<blockquote>
<p>let contractBalance &#x3D; await hre.ethers.provider.getBalance(waveContract.address);</p>
<p>hre.ethers.utils.formatEther(contractBalance)</p>
</blockquote>
<p>这句代码测试我的智能合约是否真的有0.1ETH的钱，后续我们wave之后再次打印，测试是否扣除了0.0001ETH的钱。</p>
<p>好了，运行试试看：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hardhat <span class="built_in">run</span> scripts/<span class="built_in">run</span>.js</span><br></pre></td></tr></table></figure>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16537096294314.png"></p>
<p>在运行前是0.1ETH，运行后是0.0999ETH，说明发钱成功。</p>
<p>因为要修改部署条件，所以我们要修改deploy.js：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const main = async () =&gt; &#123;</span><br><span class="line">  const waveContractFactory = await hre.ethers.getContractFactory(<span class="string">&quot;WavePortal&quot;</span>);</span><br><span class="line">  const waveContract = await waveContractFactory.deploy(&#123;</span><br><span class="line">    value: hre.ethers.utils.parseEther(<span class="string">&quot;0.001&quot;</span>),</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  await waveContract.deployed();</span><br><span class="line"></span><br><span class="line">  console.log(<span class="string">&quot;WavePortal address: &quot;</span>, waveContract.address);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const runMain = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    await main();</span><br><span class="line">    process.<span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(error);</span><br><span class="line">    process.<span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">runMain();</span><br></pre></td></tr></table></figure>

<p>所以，我们再次部署智能合约到区块链：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hardhat <span class="built_in">run</span> scripts/deploy.js <span class="comment">--network rinkeby</span></span><br></pre></td></tr></table></figure>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16537099097739.png"></p>
<p>我们再次三步走：</p>
<blockquote>
<p>重新部署，记下新的合约地址</p>
<p>在网页端修改合约地址</p>
<p>在网页端修改abi文件</p>
</blockquote>
<p>现在，我的钱包在打招呼前有0.094ETH:</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16537100975938.png"></p>
<p>打招呼的燃料费：0.00019ETH<br><img src="http://luwenjuan.luyuedan.com/mweb/16537102492282.png"></p>
<p>打招呼后还有0.0939ETH，收到了智能合约发来的0.0001ETH的钱。<br><img src="http://luwenjuan.luyuedan.com/mweb/16537102652742.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O1-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%881%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O1-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%881%EF%BC%89/" class="post-title-link" itemprop="url">OpenSea：从0开始到从OpenSea买第一个NFT（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-01T15:21:41+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-29 15:09:13" itemprop="dateModified" datetime="2022-08-29T15:09:13+08:00">2022-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/OpenSea/" itemprop="url" rel="index"><span itemprop="name">OpenSea</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="OpenSea：从0开始到从OpenSea买第一个NFT（一）" href="/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O1-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%881%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::7b307ad05ffb66838cd0a92a192faee5" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>NFT现在很火，但很多小伙伴其实依然很懵，连OpenSea怎么登陆都不知道，包括前段时间的我自己。</p>
<p>我也是到处找碎片资料拼凑，尝试，自己操作一遍，才形成了这篇文章。所以本文章是针对从来没有接触过NFT的小白，带你登陆OpenSea，并买（mint）到你的第一个NFT。</p>
<p>那么第一次想要买个NFT，需要哪些步骤呢？</p>
<blockquote>
<p>第一步：科学上网</p>
<p>第二步：注册小狐狸钱包</p>
<p>第三步：钱包添加到Polygan链</p>
<p>第四步：充值兑换ETH</p>
<p>第五步：OpenSea使用介绍</p>
<p>第六步：用ETH在OpenSea购买NFT</p>
</blockquote>
<h2 id="第一步：科学上网"><a href="#第一步：科学上网" class="headerlink" title="第一步：科学上网"></a>第一步：科学上网</h2><p>因为OpenSea是国外网站，所以涉及到上外网的问题，上外网的方式很多，我直接用商业版软件expressVPN。</p>
<p>这是官网网址，使用这个链接注册可以获得一个月免费试用：<a target="_blank" rel="noopener" href="https://www.expressrefer.com/refer-a-friend/30-days-free?referrer_id=20831838&amp;utm_campaign=referrals&amp;utm_medium=copy_link&amp;utm_source=referral_dashboard">https://www.expressrefer.com/refer-a-friend/30-days-free?referrer_id=20831838&amp;utm_campaign=referrals&amp;utm_medium=copy_link&amp;utm_source=referral_dashboard</a></p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16523651361108.png"></p>
<h2 id="第二步：注册小狐狸钱包"><a href="#第二步：注册小狐狸钱包" class="headerlink" title="第二步：注册小狐狸钱包"></a>第二步：注册小狐狸钱包</h2><p>小狐狸钱包官网：<a target="_blank" rel="noopener" href="https://metamask.io/">https://metamask.io/</a></p>
<p>点击Download，就会让你安装浏览器插件，跟着步骤一步一步来就好：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16520192539140.png"></p>
<p>当我们安装好了以后，浏览器右上角就会出现小狐狸图标：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16523655508277.png"></p>
<p>点击小狐狸图标，开始使用钱包的设置：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16520192248116.png"></p>
<p>接着又是一步一步跟随指引操作就好，这里注意，助记词密语一定要记到本子上面：<br><img src="http://luwenjuan.luyuedan.com/mweb/16614188066117.png"></p>
<p>接着跟着提示填写助记词，创建钱包一定要自己操作，不要让别人参与，好啦，装好了。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/411652360162_.pic.jpg" alt="411652360162_.pic"></p>
<h2 id="第三步：钱包添加到Polygan链"><a href="#第三步：钱包添加到Polygan链" class="headerlink" title="第三步：钱包添加到Polygan链"></a>第三步：钱包添加到Polygan链</h2><p>这一步也可以不做，主要是因为以太坊主链gas费太高了，这一步是为了节省gas费。</p>
<p>这里添加网络：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/481652360419_.pic.jpg" alt="481652360419_.pic"></p>
<blockquote>
<p>网络名称：MAINTIC Mainnet<br>新RPC的URL:<a target="_blank" rel="noopener" href="https://rpc-mainnet.maticvigil.com/">https://rpc-mainnet.maticvigil.com/</a><br>链ID:137<br>代币名称：MATIC<br>区块资源管理器URL:<a target="_blank" rel="noopener" href="https://explorer.matic.network/">https://explorer.matic.network/</a></p>
</blockquote>
<p><img src="http://luwenjuan.luyuedan.com/mweb/521652360628_.pic.jpg" alt="521652360628_.pic"></p>
<p>保存即可，我们的小狐狸钱包就设置好了。</p>
<p>今天由于时间有限，我每天要11点睡，后面几个步骤明天再更新，欢迎持续关注我。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O2-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%882%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O2-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%882%EF%BC%89/" class="post-title-link" itemprop="url">OpenSea：从0开始到从OpenSea买第一个NFT（二）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-01T15:21:41+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-25 17:31:36" itemprop="dateModified" datetime="2022-08-25T17:31:36+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/OpenSea/" itemprop="url" rel="index"><span itemprop="name">OpenSea</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="OpenSea：从0开始到从OpenSea买第一个NFT（二）" href="/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O2-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%882%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::d1615a545d6c39006f38cacb48d0f726" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>昨天的文章讲了，第一次想要买个NFT，需要这些步骤：</p>
<blockquote>
<p>第一步：科学上网</p>
<p>第二步：注册小狐狸钱包</p>
<p>第三步：钱包添加到Polygan链</p>
<p>第四步：充值兑换ETH</p>
<p>第五步：OpenSea使用介绍</p>
<p>第六步：用ETH在OpenSea购买NFT</p>
</blockquote>
<p>已经讲完前三步，可以去看一下：【链接】，今天继续……</p>
<h2 id="第四步：购买ETH"><a href="#第四步：购买ETH" class="headerlink" title="第四步：购买ETH"></a>第四步：购买ETH</h2><p>欧易网址：<a target="_blank" rel="noopener" href="https://www.ouyicn.men/join/18296185">https://www.ouyicn.men/join/18296185</a><br>币安网址：<a target="_blank" rel="noopener" href="https://www.binance.com/zh-CN">https://www.binance.com/zh-CN</a></p>
<p>使用邮箱注册：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16524180765969.png"></p>
<p>买币：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614196611558.png"></p>
<p>由于OpenSea购买NFT需要用eth，直接购买eth手续费比较高；所以先在欧易购买其他币种，然后兑换成matic，提现到小狐狸钱包，再用小狐狸账号转成eth，这样手续费会低一些。</p>
<p>这里先购买usdt：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16524245958196.png"></p>
<p>点击购买，用卖家要求的方式付款：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614196974341.png"></p>
<p>欧易是一个数字币交易所，买币也是从其他玩家手上购买的，购买完成。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16524255797118.png"></p>
<p>兑换成matic：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614197227592.png"></p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16524257282000.png"></p>
<p>兑换成功：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16524258231030.png"></p>
<p>提现：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614197453558.png"></p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614197571639.png"></p>
<p>这里的地址是小狐狸钱包地址：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614197816819.png"></p>
<p>就是这里，复制即可：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614197955545.png"></p>
<p>提现后，matic就到小狐狸钱包了。<br><img src="http://luwenjuan.luyuedan.com/mweb/16614198124558.png"></p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16524516309512.png"></p>
<p>审查兑换即可，然后小狐狸钱包里就有swap了。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16524516769544.png"></p>
<p>用swap兑换eth。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16524517413885.png"></p>
<p>由于我今天刚刚改密码，于是我就无法提现了，所以暂时没有eth可以去OpenSea逛，后续的就明天更新吧。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O3-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%883%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O3-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%883%EF%BC%89/" class="post-title-link" itemprop="url">OpenSea：从0开始到从OpenSea买第一个NFT(三）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 15:21:41" itemprop="dateCreated datePublished" datetime="2022-07-01T15:21:41+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-25 17:35:04" itemprop="dateModified" datetime="2022-08-25T17:35:04+08:00">2022-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/OpenSea/" itemprop="url" rel="index"><span itemprop="name">OpenSea</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="OpenSea：从0开始到从OpenSea买第一个NFT(三）" href="/2022/07/01/%E5%85%83%E5%AE%87%E5%AE%99/O3-%E4%BB%8E0%E5%BC%80%E5%A7%8Bopensea%EF%BC%883%EF%BC%89/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::74d43ebc9d1abb35eb1e28a558f77fa0" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>昨天的文章讲了，第一次想要买个NFT，需要这些步骤：</p>
<blockquote>
<p>第一步：科学上网</p>
<p>第二步：注册小狐狸钱包</p>
<p>第三步：钱包添加到Polygan链</p>
<p>第四步：充值兑换ETH</p>
<p>第五步：OpenSea使用介绍</p>
<p>第六步：用ETH在OpenSea购买NFT</p>
</blockquote>
<p>已经讲完前几步，可以去看一下：</p>
<p>今天继续……</p>
<h2 id="第五步：OpenSea使用介绍"><a href="#第五步：OpenSea使用介绍" class="headerlink" title="第五步：OpenSea使用介绍"></a>第五步：OpenSea使用介绍</h2><p>OpenSea目前是全球最大的NFT交易平台，这是OpenSea链接：<a target="_blank" rel="noopener" href="https://opensea.io/">https://opensea.io/</a></p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16525346770464.png"></p>
<p>Explore可以浏览平台上的所有NFT，可以分类浏览，排序，过滤，搜索，用最快速度找到自己想要的NFT，所以这个部分自己去探索就可以了。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16525353296443.png"></p>
<p>那些标示了Buy Now的是一口价，购买付款就可以直接买到，其他的可能是拍卖的，在拍卖期内价高者得。</p>
<h2 id="第六步：用ETH在OpenSea购买NFT"><a href="#第六步：用ETH在OpenSea购买NFT" class="headerlink" title="第六步：用ETH在OpenSea购买NFT"></a>第六步：用ETH在OpenSea购买NFT</h2><p>然后我们随便选择一个Buy Now的，看看怎么购买。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/%25E6%2588%25AA%25E5%25B1%258F2022-05-14%2520%25E4%25B8%258B%25E5%258D%25889.45.29.png" alt="截屏2022-05-14 下午9.45.29"></p>
<p>点击Buy Now，会让你连接小狐狸钱包。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614200689720.png"></p>
<p>然后会计算出要花多少钱，确认了点Add Funds就行，后面会要求你签名确认，谨慎购买。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16525362342359.png"></p>
<h2 id="第七步：发布一个自己的NFT"><a href="#第七步：发布一个自己的NFT" class="headerlink" title="第七步：发布一个自己的NFT"></a>第七步：发布一个自己的NFT</h2><p>首先创建一个自己的collection，点击头像，my collections - create collection。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16614200893045.png"></p>
<p>填上该填的信息之后，点击create就行。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16525389024355.png"></p>
<p>好了，灵猫家族的collection就创建好了，接下来我们就一个一个的创造成员吧。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16525389644065.png"></p>
<p>在OpenSea界面点击Create，小狐狸钱包会请求签名，点签名，就可以看到这个界面：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16525371872882.png"></p>
<p>我们把之前制作的头像上传上去，填写好该填的内容后，点击create。</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16525390825006.png"></p>
<p>会提醒你进行人机验证，验证过后，就可以上传成功了，由于我的浏览器有点问题，人机验证一直不反应，所以就不截图了。</p>
<p>在作品上传成功后，点击sell把它挂出去，选择价格和日期，点击完成，小狐狸会提醒签名，就可以挂到OpenSea上卖了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/02/%E5%89%8D%E7%AB%AF/%E4%BD%BF%E7%94%A8%E5%9B%BE%E6%A0%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luwenjuan.jpeg">
      <meta itemprop="name" content="卢文娟">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卢文娟">
      <meta itemprop="description" content="微信: 13246411679">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 卢文娟">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/02/%E5%89%8D%E7%AB%AF/%E4%BD%BF%E7%94%A8%E5%9B%BE%E6%A0%87/" class="post-title-link" itemprop="url">使用阿里云图标</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-02 15:21:41" itemprop="dateCreated datePublished" datetime="2020-06-02T15:21:41+08:00">2020-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-29 14:54:34" itemprop="dateModified" datetime="2022-08-29T14:54:34+08:00">2022-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" itemprop="url" rel="index"><span itemprop="name">小程序</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="使用阿里云图标" href="/2020/06/02/%E5%89%8D%E7%AB%AF/%E4%BD%BF%E7%94%A8%E5%9B%BE%E6%A0%87/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::4a5aadf64f28cfcd491a2bad39249e93" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>先下载至本地，要下载代码哦</p>
<p><img src="/media/16614255442841.png"></p>
<p>解压后得到这些文件：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16560586037349.png"></p>
<p>小程序需要的是base64格式，所以使用这个网站转换格式：<a target="_blank" rel="noopener" href="https://transfonter.org/">https://transfonter.org/</a></p>
<p>我们使用阿里的iconfont.ttf文件，去转换成我们需要的CSS文件，所以这里上传.ttf格式的文件，看清操作顺序：</p>
<p><img src="http://luwenjuan.luyuedan.com/mweb/16560588084260.png"></p>
<p>转换下载后，解压就是这样的格式，其中css文件是我们需要的：<br><img src="http://luwenjuan.luyuedan.com/mweb/16560588530887.png"></p>
<p>在小程序项目下建立公共样式文件，lib&#x2F;style&#x2F;icon.wxss<br><img src="http://luwenjuan.luyuedan.com/mweb/16560590177303.png"></p>
<p>直接把我们转换好的css文件内容拷贝进去，接下来可以去引用这些icon样式。</p>
<p>先写一些text标签的内容<br><img src="http://luwenjuan.luyuedan.com/mweb/16560593841765.png"></p>
<p>然后再设置样式，在对应的样式文件中加入：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&quot;../../lib/style/icon.wxss&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.lihao</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line"><span class="attribute">font-family</span>:<span class="string">&#x27;iconfont&#x27;</span>;</span><br><span class="line"><span class="attribute">font-weight</span>:<span class="number">50</span>;</span><br><span class="line"><span class="attribute">font-style</span>:normal;</span><br><span class="line"><span class="attribute">content</span>:<span class="string">&#x27;\ee32&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他图标都是如此排列。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">卢文娟</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cywbdqFL8","appkey":"1e0802ef26195d974f4576578a580da3"}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
